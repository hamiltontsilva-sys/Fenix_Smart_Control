1. Visão Geral

O Fênix Smart Control é um sistema inteligente de controle de reservatório com três poços, projetado para automação, segurança e monitoramento remoto via MQTT e interface Web.
Ele opera de forma totalmente automática, com rodízio dos poços, retrolavagem inteligente, detecção de falhas e supervisão em tempo real.

O sistema é composto por:

1 Central (ESP8266/ESP32)

3 Controladores de Poços (ESP8266)

Broker MQTT seguro (EMQX Cloud)

Dashboard Web (PWA) com monitoramento

Documentação e API REST opcional

2. Funcionalidades Principais
2.1 Controle do Reservatório

Monitoramento da boia (nível cheio/baixo)

Abertura automática de poços

Desligamento quando o reservatório enche

Prioridade configurável entre poços

2.2 Rodízio Automático

O sistema distribui o uso dos poços de forma uniforme:

Cada poço opera por um período (horas configuráveis)

Passa automaticamente para o próximo poço

Poços com falha são automaticamente ignorados

Regras de fallback para garantir abastecimento contínuo

2.3 Retrolavagem Inteligente

A Central controla a limpeza do filtro via combinação de dois poços:

Seleção de Poço A e Poço B pelo usuário

Acionamento simultâneo

Verificação automática do feedback

Aborta em caso de falha

Indicação clara no painel (“A:1 B:2”)

2.4 Monitoramento dos Poços

Cada poço envia informação em tempo real:

Alive: sinal periódico de funcionamento

Feedback do motor

Fluxo (vazão)

Online/Offline automático

Se um poço parar de responder, o sistema ignora ele até voltar.

3. Arquitetura do Sistema
3.1 Central (ESP8266/ESP32)

Responsável por:

Lógica de rodízio

Leitura da boia

Controle de relés

Supervisão dos poços

Publicação dos estados via MQTT TLS

LCD com status local

3.2 Controladores dos Poços (ESP8266)

Cada poço:

Assina comandos vindos da Central

Envia alive periódico

Retorna feedback do relé

Mede a vazão (fluxo)

Usa segurança local: se perder a Central, desliga automaticamente

3.3 Comunicação MQTT

O broker utilizado é o EMQX Cloud, com TLS (porta 8883) e WSS (8084) para Web.

Os tópicos são padronizados:

Exemplos:
central/sistema
central/nivel
central/poco_ativo
central/retropocos
pocos/p1_alive
pocos/fluxo1
pocos/cmd


Todos os estados críticos usam QoS 1 e mensagens retained.

4. Retrolavagem – Lógica Interna

Usuário define Poço A e Poço B (1..3)

Central envia comando pocos/cmd = "AB" (ex.: "12")

Poços ativam motores

Poços enviam feedback

Central valida:

Se ambos ON → retrolavagem ativa

Se 1 falhar → aborta e avisa

Central publica:

central/retrolavagem = 1

central/retropocos_status = "A:1 B:2"

5. Segurança e Failover
Poço Offline

Se um poço não enviar alive dentro do timeout:

marcado como offline

removido do rodízio

Central publica central/pX_online = 0

Feedback de motor ausente

Se o relé for ligado mas sem feedback:

tenta 2 vezes

se falhar → poço bloqueado no ciclo atual

Perda do Wi-Fi

Reconexão automática

Persistência dos estados via retained MQTT

Perda da Central

Poços desligam após timeout local (modo seguro).

6. Interface Web / App Mobile

A interface Web (PWA) permite:

Ver nível do reservatório

Ver poço ativo e fluxo

Ver status da retrolavagem

Ver poços online/offline

Ligar/desligar o sistema

Selecionar poços para retrolavagem

Definir horários e timeout

Visualizar telemetria em tempo real

Conecta via MQTT over WebSocket (WSS) com autenticação.

7. API REST Opcional

Para integração com softwares externos:

/system/status

/system/command

/pocos

/telemetry

/settings

Tudo usando HTTPS + JWT.

8. Instalação e Hardware
Central:

ESP8266/ESP32

Módulo relé para acionamento de bomba

LCD I2C opcional

Boia de nível

Fonte 5V/12V estabilizada

Poços:

ESP8266

Relé de potência

Sensor de fluxo (YF-S201 ou Hall equivalente)

9. Benefícios do Sistema

Autonomia total 24/7

Falha zero: ignora poço ruim sozinho

Economia: retrolavagem inteligente

Web App funciona em qualquer celular

Segurança via MQTT TLS

Multicamadas: Central + Poços + Nuvem

Manutenção simples

10. Conclusão

O Fênix Smart Control é um sistema completo, seguro e escalável para controle de reservatório com múltiplos poços.
Ele une eletrônica embarcada, comunicação MQTT, interface Web moderna e automação inteligente para entregar operação confiável e supervisão em tempo real.
