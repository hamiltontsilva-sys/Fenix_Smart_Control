(function(a,b){'object'===typeof exports&&'undefined'!==typeof module?b(exports):
'function'===typeof define&&define.amd?define(['exports'],b):
((a=a||self),b(a.Paho={}));})(this,function(a){
var k={trace:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}}; 
function t(b){var c=b.indexOf("://");return 0<=c?b.substr(c+3):b}
function u(b){var c=b.indexOf("/");return 0<=c?b.substr(c):"/"}
function v(b,c){this.type=b;this.errorCode=c||0;this.errorMessage="";}
function w(){this._sequence=0;}
w.prototype.next=function(){return this._sequence=(this._sequence+1)%65536};

function x(b,c){this._client=b;this._wireFormat=c;this.type="CONNECT";this.keepAliveInterval=60;
this.cleanSession=!0;this.clientId=null;this.willMessage=null;this.userName=null;this.password=null;}
x.prototype.encode=function(){
var b=this._wireFormat,c=[],d=b.encodeString(this.clientId);c.push(0);
c.push(4+2+d.length);c.push(0);c.push(4);c.push(77);c.push(81);c.push(84);c.push(b.version);
var e=this.cleanSession?2:0;this.willMessage&&(e|=4, this.willMessage.qos&&(e|=this.willMessage.qos<<3),
this.willMessage.retained&&(e|=32));this.userName&&(e|=128);this.password&&(e|=64);
c.push(e);c.push(this.keepAliveInterval>>8);c.push(this.keepAliveInterval&255);
c=c.concat(b.encodeString(this.clientId));
this.willMessage&&(c=c.concat(b.encodeString(this.willMessage.destinationName)),
c=c.concat(b.encodeMessage(this.willMessage.payloadBytes)));
this.userName&&(c=c.concat(b.encodeString(this.userName)));
this.password&&(c=c.concat(b.encodeString(this.password)));
return b.encodeMessage(1<<4,c)
};

function y(b,c){this._client=b;this._wireFormat=c;this.type="PUBLISH";this.retained=!1;
this.qos=0;this.duplicate=!1;this.destinationName="";this.payloadString=null;this.payloadBytes=null;}
y.prototype.encode=function(){
var b=this._wireFormat,c=[],d=b.encodeString(this.destinationName);c=c.concat(d);
null!==this.payloadBytes?(c=c.concat(this.payloadBytes)):
this.payloadString&&(c=c.concat(b.stringToUTF8(this.payloadString)));
return b.encodeMessage(48|(this.duplicate?8:0)|this.qos<<1|(this.retained?1:0),c)
};

function z(b,c){this._client=b;this._wireFormat=c;this.type="SUBSCRIBE";this.messageIdentifier=
this._client._sequence.next();this.topics=[];this.requestedQos=[];}
z.prototype.encode=function(){
var b=this._wireFormat,c=[this.messageIdentifier>>8,this.messageIdentifier&255],d;
for(d=0;d<this.topics.length;d++){
var e=b.encodeString(this.topics[d]);c=c.concat(e);c.push(this.requestedQos[d])
}
return b.encodeMessage(130,c)
};

function A(b){this.client=b;this.onMessageArrived=null;this.onConnectionLost=null;
this.onConnected=null;this.connected=!1;this._reconnectTimeout=1E3;
this._maxReconnectInterval=8E3;this._connectOptions=null;this._reconnectTimer=null;
this._traceFunction=null;this._sequence=new w;this._ws=null;this._wsuri=null;
this._keepAliveTimer=null;this._msgQueue=[];this._notifySent=function(){};}

A.prototype.connect=function(b){
var c=this;
if(this.connected)throw Error("Already connected.");
this._connectOptions=b||({});
var d=b.userName,e=b.password; 
var f=b.useSSL?"wss://":"ws://";
this._wsuri=f+this.host+":"+this.port+this.path;
this._ws=new WebSocket(this._wsuri,"mqtt");
this._ws.binaryType="arraybuffer";
this._ws.onopen=function(){c._on_socket_open()};
this._ws.onmessage=function(g){c._on_socket_message(g)};
this._ws.onclose=function(g){c._on_socket_close(g)};
this._ws.onerror=function(g){c._on_socket_error(g)}
};
A.prototype._on_socket_open=function(){
var b=this._connectOptions,c=new x(this,this._wireFormat);
c.clientId=b.clientId;
c.keepAliveInterval=b.keepAliveInterval||60;
c.cleanSession=void 0===b.cleanSession?!0:b.cleanSession;
c.userName=b.userName;
c.password=b.password;
c.willMessage=b.willMessage;
this._ws.send(c.encode());
this.connected=!0;
this._connectOptions.onSuccess&&this._connectOptions.onSuccess({}); 
this._process_queue();
this._start_keep_alive();
};

A.prototype._on_socket_message=function(b){
b=b.data;
var c=this._wireFormat.decodeMessage(b),d=this;
if(null!==c)switch(c.type){
case "CONNACK":break;
case "PUBLISH":
var e=new y(this,this._wireFormat);
e.qos=c.qos;e.duplicate=c.duplicate;e.retained=c.retained;
e.destinationName=c.destinationName;e.payloadBytes=c.payloadBytes;
this.onMessageArrived&&this.onMessageArrived(e);
break;
case "PUBACK":break;
case "PUBREC":this._send_pubrel(c.messageIdentifier);break;
case "PUBREL":this._send_pubcomp(c.messageIdentifier);break;
case "PUBCOMP":break;
case "SUBACK":break;
case "UNSUBACK":break;
case "PINGRESP":this._trace("PINGRESP");
this._receivePong();break;
default:this._trace("Unknown message type:"+c.type)
}};

A.prototype._on_socket_close=function(b){
var c=this;
this.connected&&(this._stop_keep_alive(),this.connected=!1,
this.onConnectionLost&&this.onConnectionLost({errorCode:b.code,
errorMessage:b.reason}));
this._connectOptions.reconnect&&(this._reconnectTimer=setTimeout(function(){
c.connect(c._connectOptions)},this._reconnectTimeout),
this._reconnectTimeout=Math.min(2*this._reconnectTimeout,
this._maxReconnectInterval))
};

A.prototype._on_socket_error=function(b){
this._trace("Socket error:"+b.data);
this.onConnectionLost&&this.onConnectionLost({errorCode:1,
errorMessage:b.data})
};

A.prototype._process_queue=function(){
for(;0<this._msgQueue.length;)this._ws.send(this._msgQueue.shift())
};

A.prototype._start_keep_alive=function(){
var b=this;
this._keepAliveTimer=setInterval(function(){
b._send_pingreq()},1E3*this._connectOptions.keepAliveInterval)
};

A.prototype._stop_keep_alive=function(){clearInterval(this._keepAliveTimer)};

A.prototype._send_pingreq=function(){
this._trace("PINGREQ");
this._ws.send(this._wireFormat.encodeMessage(192,[]))
};

A.prototype._receivePong=function(){this._trace("PONG received")};

A.prototype._send_pubrel=function(b){
this._ws.send(this._wireFormat.encodeMessage(98,[b>>8,b&255]))
};

A.prototype._send_pubcomp=function(b){
this._ws.send(this._wireFormat.encodeMessage(112,[b>>8,b&255]))
};

A.prototype.subscribe=function(b,c){
var d=new z(this,this._wireFormat);
d.topics=[b];
d.requestedQos=[c||0];
this._msgQueue.push(d.encode());
this.connected&&this._process_queue()
};

A.prototype.unsubscribe=function(b){
var c=this._wireFormat.encodeString(b),d=[c[0],c[1]];
c=c.slice(2);d=d.concat(c);
this._msgQueue.push(this._wireFormat.encodeMessage(162,d));
this.connected&&this._process_queue()
};

A.prototype.send=function(b){
this._msgQueue.push(b.encode());
this.connected&&this._process_queue()
};
function B(b){
this.version=4;
this.encodeMessage=function(c,d){
var e=d.length,f=[];
for(;;){
var h=e%128;
e=Math.floor(e/128);
0<e&&(h|=128);
f.push(h);
if(0===e)break
}
return [c].concat(f,d)
};
this.decodeMessage=function(c){
var d=new DataView(c),e=0,f=d.getUint8(e++),h=f>>4,f=f&15;
var g=0,l=1,m;
do{
m=d.getUint8(e++);
g+= (m & 127) * l;
l*=128
}while(0!==(m & 128));
var n=e+g,p={buffer:c,start:e};
switch(h){
case 2:return C(p);
case 3:return D(p);
case 4:return E(p);
case 9:return F(p);
case 13:return G(p);
default:return null
}};
this.encodeString=function(c){
var d=this.stringToUTF8(c);
return [d.length>>8,d.length&255].concat(d)
};
this.encodeMessage=function(c,d){
var e=d.length,f=[];
for(;;){
var h=e%128;
e=Math.floor(e/128);
0<e&&(h|=128);
f.push(h);
if(0===e)break
}
return [c].concat(f,d)
};
this.stringToUTF8=function(c){
for(var d=[],e=0;e<c.length;e++){
var f=c.charCodeAt(e);
128>f?d.push(f):
2048>f?(d.push(192|f>>6),d.push(128|f&63)):
55296<=f&&57343>=f?(e++,
f=65536+((f&1023)<<10)+(c.charCodeAt(e)&1023),
d.push(240|f>>18),d.push(128|f>>12&63),
d.push(128|f>>6&63),d.push(128|f&63)):
(d.push(224|f>>12),d.push(128|f>>6&63),
d.push(128|f&63))
}
return d
};
}

function C(b){
var c=b.buffer,d=b.start,e=new DataView(c);
d+=2; 
d+=2; 
return {type:"CONNACK"}
}

function D(b){
var c=b.buffer,d=b.start,e=new DataView(c),
f=e.getUint16(d);d+=2;
var h=e.getUint8(d++),
g=c.slice(d,d+f-2);
return {type:"PUBLISH", qos:h>>1&3, duplicate:(h&8)>0,
retained:(h&1)>0, destinationName:null,
payloadBytes:new Uint8Array(g)}
}

function E(b){
var c=b.buffer,d=b.start,e=new DataView(c),
f=e.getUint16(d);d+=2;
return {type:"PUBACK",messageIdentifier:f}
}

function F(b){
var c=b.buffer,d=b.start,e=new DataView(c),
f=e.getUint16(d);d+=2;
return {type:"SUBACK",messageIdentifier:f,grantedQos:[e.getUint8(d)]}
}

function G(b){
var c=b.buffer,d=b.start,e=new DataView(c),
f=e.getUint16(d);d+=2;
return {type:"PINGRESP"}
}

function H(b,c,d){
this._wsurl=b;
this.clientId=c;
this._wireFormat=new B;
this.host=b;
this.port=d;
this.path="/mqtt";
this.connected=!1;
this._impl=new A(this)
}

H.prototype.connect=function(b){
b=b||({});
b.clientId=this.clientId;
this._impl.host=this.host;
this._impl.port=this.port;
this._impl.path=this.path;
this._impl.connect(b)
};

H.prototype.send=function(b){this._impl.send(b)};

H.prototype.subscribe=function(b,c){this._impl.subscribe(b,c)};

H.prototype.unsubscribe=function(b){this._impl.unsubscribe(b)};

H.prototype.disconnect=function(){
this._impl._stop_keep_alive();
this._impl._ws&&this._impl._ws.close();
this.connected=!1
};
a.MQTT={Client:H,Message:function(b){
if("string"===typeof b)this.payloadString=b;
else if(b instanceof ArrayBuffer)this.payloadBytes=new Uint8Array(b);
else if(b instanceof Uint8Array)this.payloadBytes=b;
else throw Error("Payload must be a string, ArrayBuffer or Uint8Array");
this.qos=0;this.retained=!1;this.duplicate=!1;this.destinationName=null;
this.encode=function(){
var c=new B,d=[];
d=d.concat(c.encodeString(this.destinationName));
null!==this.payloadBytes?d=d.concat(this.payloadBytes):
this.payloadString&&(d=d.concat(c.stringToUTF8(this.payloadString)));
return c.encodeMessage(48|(this.duplicate?8:0)|this.qos<<1|
(this.retained?1:0),d)
}}};
});
